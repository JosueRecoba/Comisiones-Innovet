{% extends "comisiones/base.html" %}

{% block title %}Calcular Comisiones{% endblock %}

{% block content %}
<div class="calcular-comisiones-container">
    <h2>Calcular Comisiones</h2>
    
    <!-- Formulario para seleccionar el folio -->
    <form method="POST" id="calcularComisionesForm" class="comision-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="folio">Selecciona Folio:</label>
            <select id="folio" name="folio" onchange="cargarDatosFolio()">
                <option value="">Seleccione un Folio</option>
                {% for factura in facturas %}
                <option value="{{ factura.id }}">{{ factura.folio }}</option>
                {% endfor %}
            </select>
        </div>
    </form>

    <!-- Secci贸n para mostrar los datos del folio -->
    <div id="datos-comision" style="display:none; margin-top: 20px;">
        <div class="form-group">
            <label for="cliente">Cliente:</label>
            <input type="text" id="cliente" name="cliente" readonly>
        </div>
        <div class="form-group">
            <label for="estatus">Estatus de la Factura:</label>
            <input type="text" id="estatus" name="estatus" readonly>
        </div>
        <div class="form-group">
            <label for="subtotal">Subtotal:</label>
            <input type="text" id="subtotal" name="subtotal" readonly>
        </div>
        <div class="form-group">
            <label for="comision">Comisi贸n:</label>
            <input type="text" id="comision" name="comision" readonly>
        </div>
        <div class="form-group">
            <label for="vendedor">Vendedor:</label>
            <input type="text" id="vendedor" name="vendedor" readonly>
        </div>
    </div>
</div>

<script>
    // Funci贸n para cargar los datos del folio seleccionado
    function cargarDatosFolio() {
        const folioId = document.getElementById('folio').value;

        if (folioId) {
            // Realizar la solicitud al servidor
            fetch(`/comisiones/calcular-comisiones/${folioId}/`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error al obtener los datos del folio.');
                }
                return response.json();
            })
            .then(data => {
                // Mostrar los datos en los campos correspondientes
                document.getElementById('datos-comision').style.display = 'block';
                document.getElementById('cliente').value = data.cliente || 'N/A';
                document.getElementById('estatus').value = data.estatus || 'N/A';
                document.getElementById('subtotal').value = data.subtotal || '0.00';
                document.getElementById('comision').value = data.comision || '0.00';
                document.getElementById('vendedor').value = data.vendedor || 'N/A';
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un problema al cargar los datos del folio. Por favor, intenta de nuevo.');
            });
        } else {
            // Si no hay folio seleccionado, ocultar la secci贸n de datos
            document.getElementById('datos-comision').style.display = 'none';
        }
    }
</script>
{% endblock %}
